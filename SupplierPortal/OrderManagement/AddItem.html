<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/SupplierPortal/TableManager.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../../nippon.css" />
    <!-- Icon Css -->
    <link
      rel="stylesheet"
      href="../assets/fonts/FluentSystemIcons-Regular.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css"
    />
    <!-- End of Icon css -->
    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;900&display=swap"
      rel="stylesheet"
    />
    <title>Simplify</title>
  </head>
  <body style="background-color: white">
    <div id="sidebar-container"></div>
    <div class="main-container">
      <div id="header-container"></div>
      <!-- header -->
      <!-- End of Header -->

      <!-- Mid header -->
      <div class="mid-header" style="background-color: #eeeeee">
        <div class="row container-fluid">
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              <a href="/SupplierPortal/OrderManagement/Item.html" class="me-2">
                <img src="/icons/Arrow back ios (2).svg" alt="back" />
              </a>
              <h2>Add/Edit Item</h2>
            </div>
            <div>
              <a href="" class="text-decoration-none me-2">
                <img src="/icons/Synchronize.svg" alt="" />
              </a>
              <button class="border-0">
                <img
                  src="/icons/save.svg"
                  alt=""
                  id="SaveBtn"
                  onclick="saveDataToLocalStorage();"
                />
              </button>
            </div>
          </div>
        </div>
      </div>
      <div
        class="d-flex justify-content-between flex-column profile-update-container"
      >
        <form action="" id="itemForm" class="container-fluid mt-4">
          <div class="row mb-3">
            <!-- Item Code -->
            <div class="col-12 col-md-6 mb-3">
              <label for="itemCode" class="form-label">Item Code*</label>
              <input type="text" id="itemCode" class="form-control" />
              <div
                id="itemCodeError"
                class="text-danger mt-1"
                style="display: none"
              >
                Item Code is required.
              </div>
            </div>
            <!-- Item Description -->
            <div class="col-12 col-md-6 mb-3">
              <label for="itemDescription" class="form-label"
                >Item Description*</label
              >
              <input type="text" id="itemDescription" class="form-control" />
              <div
                id="itemDescriptionError"
                class="text-danger mt-1"
                style="display: none"
              >
                Item Description is required.
              </div>
            </div>
          </div>

          <div class="row mb-3">
            <!-- Item Specification -->
            <div class="col-12 col-md-6 mb-3">
              <label for="itemSpecification" class="form-label"
                >Item Specification*</label
              >
              <input type="text" id="itemSpecification" class="form-control" />
              <div
                id="itemSpecificationError"
                class="text-danger mt-1"
                style="display: none"
              >
                Item Specification required.
              </div>
            </div>
            <!-- Image -->
            <div class="col-12 col-md-6 mb-3">
              <label for="image" class="form-label">Image*</label>
              <input type="file" id="image" class="form-control" />
              <div
                id="imageError"
                class="text-danger mt-1"
                style="display: none"
              >
                Image required.
              </div>
            </div>
          </div>
          <div></div>
        </form>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="/SupplierPortal/loadContent.js"></script>
    <script src="../OrderManagement/OrderDispatch.js"></script>
    <script src="../tableManager2.js"></script>
    <script src="../index.js"></script>
    <script>
      initializeTableManager("../tableConfigs.json");
    </script>
    <script>
      function saveDataToLocalStorage() {
        console.log("Saving form data to localStorage!");

        // Input fields
        const itemCode = document.getElementById("itemCode");
        const itemDescription = document.getElementById("itemDescription");
        const itemSpecification = document.getElementById("itemSpecification");
        const image = document.getElementById("image");

        // Error message elements
        const itemCodeError = document.getElementById("itemCodeError");
        const itemDescriptionError = document.getElementById(
          "itemDescriptionError"
        );
        const itemSpecificationError = document.getElementById(
          "itemSpecificationError"
        );
        const imageError = document.getElementById("imageError");

        // Validate fields
        let isValid = true;

        // Item Code validation
        if (!itemCode.value.trim()) {
          itemCodeError.style.display = "block";
          isValid = false;
        } else {
          itemCodeError.style.display = "none";
        }

        // Item Description validation
        if (!itemDescription.value.trim()) {
          itemDescriptionError.style.display = "block";
          isValid = false;
        } else {
          itemDescriptionError.style.display = "none";
        }

        // Item Specification validation
        if (!itemSpecification.value.trim()) {
          itemSpecificationError.style.display = "block";
          isValid = false;
        } else {
          itemSpecificationError.style.display = "none";
        }

        // Image validation
        if (!image.files || image.files.length === 0) {
          imageError.style.display = "block";
          isValid = false;
        } else {
          imageError.style.display = "none";
        }

        if (isValid) {
          // Prepare the form data
          const formData = {
            itemCode: itemCode.value.trim(),
            itemDescription: itemDescription.value.trim(),
            itemSpecification: itemSpecification.value.trim(),
          };

          // Read the file content
          const file = image.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
              const fileContent = event.target.result; // Base64 encoded string
              formData.imagePath = fileContent;

              // Save to localStorage
              localStorage.setItem("formData", JSON.stringify(formData));
              console.log("Form data saved to localStorage:", formData);

              // Notify the user
              alert("Form data has been saved successfully!");
            };

            // Read file as Data URL
            reader.readAsDataURL(file);
          }
        }
      }

      // Attach event listener to the save button
      document.addEventListener("DOMContentLoaded", () => {
        const saveBtn = document.getElementById("saveBtn");
        saveBtn.addEventListener("click", saveDataToLocalStorage);
      });
    </script>
  </body>
</html>
